{
  "name": "LLM to Architect Bridge",
  "nodes": [
    {
      "id": "trigger",
      "name": "Trigger (from LLM)",
      "type": "n8n-nodes-base.manualTrigger",
      "position": [250, 300],
      "parameters": {}
    },
    {
      "id": "prepare-architect-data",
      "name": "Prepare Architect Data",
      "type": "n8n-nodes-base.code",
      "position": [450, 250],
      "parameters": {
        "jsCode": "// Prepare data for architect agent based on LLM analysis\n// This would normally come from Basic LLM Chain output\nconst llmAnalysis = {\n  task_type: \"feature\",\n  components: [\"workflow-api\", \"workflow-engine\", \"workflow-common\", \"workflow-service-client\"],\n  subtasks: [\n    \"–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ä–æ–ª–µ–π –≤ workflow-common\",\n    \"–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (JWT/OAuth2)\",\n    \"–î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –≤ workflow-api\",\n    \"–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ workflow-engine –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤\",\n    \"–û–±–Ω–æ–≤–∏—Ç—å workflow-service-client –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\",\n    \"–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ application.properties/yml\"\n  ],\n  recommended_agent: \"architect\",\n  complexity: \"high\",\n  estimated_time: \"3-5 days\",\n  notes: \"–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Ä–æ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, Admin, User, Viewer) –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–ª—è workflow. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ—à–∏—Ç—å, –±—É–¥–µ—Ç –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º (Keycloak, Auth0). –í–∞–∂–Ω–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—É—é –ø–µ—Ä–µ–¥–∞—á—É –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤.\",\n  code_references: [\n    {\n      file: \"workflow-api/src/main/java/com/uwf/workflow/api/controller/WorkflowController.java\",\n      purpose: \"–î–æ–±–∞–≤–∏—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ @PreAuthorize –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º\"\n    },\n    {\n      file: \"workflow-common/src/main/java/com/uwf/workflow/common/model/\",\n      purpose: \"–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∞—Å—Å—ã User, Role, Permission\"\n    },\n    {\n      file: \"workflow-api/src/main/resources/application.yml\",\n      purpose: \"–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é security –∏ JWT\"\n    }\n  ]\n};\n\n// Create architect request\nconst architectRequest = {\n  request: \"–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è unified-workflow –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ LLM\",\n  llmAnalysis: llmAnalysis,\n  priority: \"high\",\n  workflowId: `auth-${Date.now()}`,\n  timestamp: new Date().toISOString(),\n  requirements: {\n    mustHave: [\n      \"–†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å (Admin, User, Viewer)\",\n      \"JWT-based –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è\",\n      \"–ó–∞—â–∏—â–µ–Ω–Ω—ã–µ REST endpoints\",\n      \"–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å workflow-engine\"\n    ],\n    niceToHave: [\n      \"OAuth2 –ø–æ–¥–¥–µ—Ä–∂–∫–∞\",\n      \"–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Keycloak/Auth0\",\n      \"Audit logging\",\n      \"Rate limiting\"\n    ]\n  }\n};\n\nreturn [{\n  json: architectRequest\n}];"
      }
    },
    {
      "id": "call-architect-workflow",
      "name": "Call Architect Workflow",
      "type": "n8n-nodes-base.httpRequest",
      "position": [650, 250],
      "parameters": {
        "url": "http://localhost:5678/webhook/architect-v2",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "values": [
            {
              "name": "request",
              "value": "={{$json.request}}"
            },
            {
              "name": "llmAnalysis",
              "value": "={{$json.llmAnalysis}}"
            },
            {
              "name": "workflowId",
              "value": "={{$json.workflowId}}"
            }
          ]
        },
        "options": {
          "timeout": 30000
        }
      }
    },
    {
      "id": "process-architect-response",
      "name": "Process Architect Response",
      "type": "n8n-nodes-base.code",
      "position": [850, 250],
      "parameters": {
        "jsCode": "// Process architect's response\nconst architectResponse = $input.first().json;\n\n// Extract specification from architect\nconst specification = architectResponse.specification || architectResponse.finalResult?.specification;\n\nif (!specification) {\n  return [{\n    json: {\n      status: \"error\",\n      message: \"Architect didn't return specification\",\n      rawResponse: architectResponse,\n      timestamp: new Date().toISOString()\n    }\n  }];\n}\n\n// Enhance specification with LLM analysis\nconst enhancedSpecification = {\n  ...specification,\n  llmAnalysis: architectResponse.llmAnalysis || {},\n  implementationPlan: {\n    phases: [\n      {\n        name: \"Phase 1: –ú–æ–¥–µ–ª–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è\",\n        tasks: [\n          \"–°–æ–∑–¥–∞—Ç—å User, Role, Permission –º–æ–¥–µ–ª–∏ –≤ workflow-common\",\n          \"–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Spring Security —Å JWT\",\n          \"–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ application.yml\"\n        ],\n        estimatedTime: \"2 days\"\n      },\n      {\n        name: \"Phase 2: API –∏ —Å–µ—Ä–≤–∏—Å—ã\",\n        tasks: [\n          \"–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AuthController —Å endpoints\",\n          \"–î–æ–±–∞–≤–∏—Ç—å @PreAuthorize –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏\",\n          \"–°–æ–∑–¥–∞—Ç—å UserService –∏ RoleService\"\n        ],\n        estimatedTime: \"2 days\"\n      },\n      {\n        name: \"Phase 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è\",\n        tasks: [\n          \"–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤ workflow-engine\",\n          \"–û–±–Ω–æ–≤–∏—Ç—å workflow-service-client\",\n          \"–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã\"\n        ],\n        estimatedTime: \"1-2 days\"\n      }\n    ],\n    totalEstimatedTime: \"5-6 days\"\n  },\n  nextSteps: [\n    \"1. –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É git –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏\",\n    \"2. –ù–∞—á–∞—Ç—å —Å Phase 1 (–º–æ–¥–µ–ª–∏)\",\n    \"3. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 1 –ø–µ—Ä–µ–π—Ç–∏ –∫ TDD-—Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫—É\"\n  ]\n};\n\nreturn [{\n  json: {\n    status: \"success\",\n    message: \"Architect created detailed specification\",\n    workflowId: architectResponse.workflowId || `workflow-${Date.now()}`,\n    specification: enhancedSpecification,\n    timestamp: new Date().toISOString(),\n    nextAgent: \"tdd-tester\",\n    delivery: {\n      format: \"Git branch + PR\",\n      repository: \"github.com/kgapparov/unified-workflow\",\n      branchName: \"feature/auth-system\"\n    }\n  }\n}];"
      }
    },
    {
      "id": "format-final-response",
      "name": "Format Final Response",
      "type": "n8n-nodes-base.code",
      "position": [1050, 250],
      "parameters": {
        "jsCode": "// Format final response for chat/user\nconst data = $input.first().json;\nconst spec = data.specification;\n\nconst chatResponse = `\nüèóÔ∏è **–ê–†–•–ò–¢–ï–ö–¢–û–† –ó–ê–í–ï–†–®–ò–õ –†–ê–ë–û–¢–£**\n\n‚úÖ **–ó–∞–¥–∞—á–∞:** ${spec.workflowName || '–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏'}\nüìã **ID:** ${data.workflowId}\n‚ö° **–°–ª–æ–∂–Ω–æ—Å—Ç—å:** ${spec.llmAnalysis?.complexity || 'high'}\n‚è±Ô∏è **–û–±—â–µ–µ –≤—Ä–µ–º—è:** ${spec.implementationPlan?.totalEstimatedTime || '5-6 –¥–Ω–µ–π'}\n\nüìä **–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**\n${spec.implementationPlan?.phases?.map(p => `\\n**${p.name}** (${p.estimatedTime})\\n${p.tasks.map(t => `  ‚Ä¢ ${t}`).join('\\n')}`).join('\\n')}\n\nüîó **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**\n${spec.nextSteps?.map(s => `  ‚Ä¢ ${s}`).join('\\n')}\n\nüìÅ **–î–æ—Å—Ç–∞–≤–∫–∞:**\n  ‚Ä¢ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: ${data.delivery?.repository}\n  ‚Ä¢ –í–µ—Ç–∫–∞: ${data.delivery?.branchName}\n  ‚Ä¢ –§–æ—Ä–º–∞—Ç: ${data.delivery?.format}\n\nü§ñ **–°–ª–µ–¥—É—é—â–∏–π –∞–≥–µ–Ω—Ç:** ${data.nextAgent}\n`;\n\nreturn [{\n  json: {\n    ...data,\n    chatResponse: chatResponse,\n    summary: {\n      task: \"–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\",\n      status: \"designed\",\n      timestamp: new Date().toISOString(),\n      agents: [\"llm-analyst\", \"architect\"],\n      nextAgent: data.nextAgent\n    }\n  }\n}];"
      }
    }
  ],
  "connections": {
    "Trigger (from LLM)": {
      "main": [
        [
          {
            "node": "Prepare Architect Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Architect Data": {
      "main": [
        [
          {
            "node": "Call Architect Workflow",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call Architect Workflow": {
      "main": [
        [
          {
            "node": "Process Architect Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Architect Response": {
      "main": [
        [
          {
            "node": "Format Final Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {},
  "tags": ["llm", "architect", "bridge", "authorization"],
  "active": false
}
