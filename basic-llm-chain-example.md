# –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Basic LLM Chain –≤ n8n

## –°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—â–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ **Admin Chat** –∏–ª–∏ **DeepSeek Chat**, –∑–∞–ø—Ä–æ—Å –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è **Basic LLM Chain**, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏—Ç—Å—è –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π.

## –®–∞–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ n8n:

### 1. **–°–æ–∑–¥–∞–Ω–∏–µ Basic LLM Chain**
1. –í n8n –¥–æ–±–∞–≤—å—Ç–µ —É–∑–µ–ª **"Basic LLM Chain"**
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - **LLM Provider**: DeepSeek
   - **Model**: deepseek-chat
   - **Temperature**: 0.3
   - **Max Tokens**: 2000

### 2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ System Prompt**
–í –ø–æ–ª–µ **"System Prompt"** —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç:

```
–¢—ã - AI –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã unified-workflow (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä workflow). –¢–≤–æ—è –∑–∞–¥–∞—á–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, —É–ª—É—á—à–µ–Ω–∏–∏ –∏–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã.

## –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–∏—Å—Ç–µ–º—ã:
–ü—Ä–æ–µ–∫—Ç: unified-workflow - —Å–∏—Å—Ç–µ–º–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ workflow —Å AI-–∞–≥–µ–Ω—Ç–∞–º–∏.

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
1. workflow-api (REST API, –ø–æ—Ä—Ç 8080)
2. workflow-engine (–¥–≤–∏–∂–æ–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è)
3. workflow-primitive (–ø—Ä–∏–º–∏—Ç–∏–≤—ã –æ–ø–µ—Ä–∞—Ü–∏–π)
4. workflow-common (–æ–±—â–∏–µ –º–æ–¥–µ–ª–∏)
5. workflow-queue (–æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á)
6. workflow-registry (—Ä–µ–µ—Å—Ç—Ä workflow)
7. workflow-service-client (–∫–ª–∏–µ–Ω—Ç)

AI-–∞–≥–µ–Ω—Ç—ã: Architect, TDD-Tester, Implementer, Docker-Packager.

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:
- –û–ø—Ä–µ–¥–µ–ª–∏ —Ç–∏–ø –∑–∞–¥–∞—á–∏: feature, bug, improvement
- –û–ø—Ä–µ–¥–µ–ª–∏ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –û—Ü–µ–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å: low, medium, high
- –ü—Ä–µ–¥–ª–æ–∂–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
- –í–°–ï–ì–î–ê –≤–æ–∑–≤—Ä–∞—â–∞–π –¢–û–õ–¨–ö–û JSON –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

{
  "task_type": "feature|bug|improvement",
  "components": ["component1", "component2"],
  "subtasks": ["–ø–æ–¥–∑–∞–¥–∞—á–∞1", "–ø–æ–¥–∑–∞–¥–∞—á–∞2"],
  "recommended_agent": "architect|tdd-tester|implementer|docker-packager",
  "complexity": "low|medium|high",
  "estimated_time": "2 hours",
  "notes": "—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏",
  "code_references": [{"file": "–ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É", "purpose": "–æ–ø–∏—Å–∞–Ω–∏–µ"}]
}
```

### 3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ User Input**
- **Input Source**: "From previous node" –∏–ª–∏ "Manual"
- **User Message**: `{{$json.message}}` (–µ—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏–∑ —á–∞—Ç–∞)

### 4. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ Code Node –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞**
–ü–æ—Å–ª–µ Basic LLM Chain –¥–æ–±–∞–≤—å—Ç–µ —É–∑–µ–ª **"Code"** —Å —Ç–∞–∫–∏–º JavaScript –∫–æ–¥–æ–º:

```javascript
// Parse LLM response
const llmResponse = $input.first().json;

// Extract JSON from response (LLM might return text with JSON)
let analysis = {};
let rawResponse = '';

if (typeof llmResponse === 'string') {
  rawResponse = llmResponse;
  try {
    // Try to extract JSON from text
    const jsonMatch = llmResponse.match(/\{.*\}/s);
    if (jsonMatch) {
      analysis = JSON.parse(jsonMatch[0]);
    }
  } catch (e) {
    analysis = { error: 'Failed to parse JSON', raw: llmResponse };
  }
} else if (llmResponse.content) {
  rawResponse = llmResponse.content;
  try {
    analysis = JSON.parse(llmResponse.content);
  } catch (e) {
    analysis = { error: 'Failed to parse content', raw: llmResponse.content };
  }
} else {
  analysis = llmResponse;
}

// Prepare data for next steps
const result = {
  originalRequest: $input.first().json.message || 'No message',
  llmRawResponse: rawResponse,
  analysis: analysis,
  timestamp: new Date().toISOString(),
  workflowId: `analysis-${Date.now()}`
};

// Log for debugging
console.log('LLM Analysis Result:', JSON.stringify(result, null, 2));

return [{ json: result }];
```

### 5. **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫ –∞–≥–µ–Ω—Ç–∞–º**
–î–æ–±–∞–≤—å—Ç–µ –µ—â–µ –æ–¥–∏–Ω **Code Node** –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏:

```javascript
const data = $input.first().json;
const analysis = data.analysis;

// Default values if analysis failed
const agent = analysis.recommended_agent || 'architect';
const taskType = analysis.task_type || 'feature';

// Prepare agent data
const agentData = {
  originalRequest: data.originalRequest,
  analysis: analysis,
  workflowId: data.workflowId,
  timestamp: data.timestamp
};

// Determine next steps
let nextAction = '';
let message = '';

switch (agent) {
  case 'architect':
    nextAction = 'call_architect_workflow';
    message = '–ó–∞–¥–∞—á–∞ –ø–µ—Ä–µ–¥–∞–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä—É –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è workflow';
    break;
  case 'tdd-tester':
    nextAction = 'call_tdd_tester';
    message = '–ó–∞–¥–∞—á–∞ –ø–µ—Ä–µ–¥–∞–Ω–∞ TDD-—Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫—É –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤';
    break;
  case 'implementer':
    nextAction = 'call_implementer';
    message = '–ó–∞–¥–∞—á–∞ –ø–µ—Ä–µ–¥–∞–Ω–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ç–æ—Ä—É –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–¥–∞';
    break;
  case 'docker-packager':
    nextAction = 'call_docker_packager';
    message = '–ó–∞–¥–∞—á–∞ –ø–µ—Ä–µ–¥–∞–Ω–∞ Docker-—É–ø–∞–∫–æ–≤—â–∏–∫—É';
    break;
  default:
    nextAction = 'manual_review';
    message = '–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–π review –∑–∞–¥–∞—á–∏';
}

return [{
  json: {
    ...data,
    routing: {
      agent: agent,
      taskType: taskType,
      nextAction: nextAction,
      message: message,
      agentData: agentData
    }
  }
}];
```

### 6. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Chat**
–ß—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å –æ—Ç–≤–µ—Ç –≤ —á–∞—Ç, –¥–æ–±–∞–≤—å—Ç–µ —É–∑–µ–ª, –∫–æ—Ç–æ—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç:

```javascript
const data = $input.first().json;
const analysis = data.analysis;
const routing = data.routing;

// Format response for chat
const chatResponse = `
üéØ **–ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω!**

üìã **–¢–∏–ø –∑–∞–¥–∞—á–∏:** ${analysis.task_type || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}
üèóÔ∏è **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** ${analysis.components ? analysis.components.join(', ') : '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã'}
‚ö° **–°–ª–æ–∂–Ω–æ—Å—Ç—å:** ${analysis.complexity || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'}
‚è±Ô∏è **–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** ${analysis.estimated_time || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'}

ü§ñ **–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç:** ${routing.agent}
üìù **–î–µ–π—Å—Ç–≤–∏–µ:** ${routing.message}

${analysis.notes ? `üìå **–ó–∞–º–µ—Ç–∫–∏:** ${analysis.notes}` : ''}

${analysis.code_references ? `üîó **–°—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–¥:** ${JSON.stringify(analysis.code_references, null, 2)}` : ''}
`;

return [{
  json: {
    chatResponse: chatResponse,
    rawData: data,
    timestamp: new Date().toISOString()
  }
}];
```

## –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ workflow:

1. **Trigger**: Admin Chat / DeepSeek Chat (–ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
2. **Basic LLM Chain**: –ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–∞ —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º
3. **Code Node 1**: –ü–∞—Ä—Å–∏–Ω–≥ JSON –æ—Ç–≤–µ—Ç–∞ –æ—Ç LLM
4. **Code Node 2**: –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫ –∞–≥–µ–Ω—Ç—É
5. **Code Node 3**: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è —á–∞—Ç–∞
6. **Respond**: –í–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç–∞ –≤ —á–∞—Ç

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

### –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ —á–∞—Ç:
```
"–î–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ OAuth2 –≤ workflow-api"
```

### –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç LLM:
```json
{
  "task_type": "feature",
  "components": ["workflow-api", "auth"],
  "subtasks": ["–î–æ–±–∞–≤–∏—Ç—å OAuth2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é", "–°–æ–∑–¥–∞—Ç—å endpoint", "–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –ø—Ä–∏–º–∏—Ç–∏–≤–∞–º–∏"],
  "recommended_agent": "architect",
  "complexity": "medium",
  "estimated_time": "4 hours",
  "notes": "–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å spring-security-oauth2",
  "code_references": [{"file": "workflow-api/src/main/java/com/uwf/workflow/api/config/PrimitivesConfig.java", "purpose": "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤"}]
}
```

### –û—Ç–≤–µ—Ç –≤ —á–∞—Ç–µ:
```
üéØ **–ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω!**

üìã **–¢–∏–ø –∑–∞–¥–∞—á–∏:** feature
üèóÔ∏è **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** workflow-api, auth
‚ö° **–°–ª–æ–∂–Ω–æ—Å—Ç—å:** medium
‚è±Ô∏è **–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 4 hours

ü§ñ **–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç:** architect
üìù **–î–µ–π—Å—Ç–≤–∏–µ:** –ó–∞–¥–∞—á–∞ –ø–µ—Ä–µ–¥–∞–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä—É –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è workflow

üìå **–ó–∞–º–µ—Ç–∫–∏:** –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å spring-security-oauth2

üîó **–°—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–¥:** [
  {
    "file": "workflow-api/src/main/java/com/uwf/workflow/api/config/PrimitivesConfig.java",
    "purpose": "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤"
  }
]
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Basic LLM Chain** —Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ** —Å —Ä–∞–∑–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
3. **–î–æ–±–∞–≤—å—Ç–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤** (–º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ Architect workflow)
4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é** –º–µ–∂–¥—É —á–∞—Ç–æ–º –∏ workflow
